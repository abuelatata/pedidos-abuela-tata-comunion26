<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Abuela Tata Â· Pedidos ComuniÃ³n 2026 Â· v2025-10-24-1</title>
  <meta name="theme-color" content="#b68aa0">
  <style>
    :root { --brand:#b68aa0; --accent:#d9b9c9; --muted:#667085; --bg:#fdf9fb; }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,'Noto Sans';background:var(--bg);color:#111}
    header{background:var(--brand);color:#fff;padding:18px 20px;position:sticky;top:0;z-index:20;display:flex;align-items:center;justify-content:space-between;gap:12px}
    h1{margin:0;font-size:20px;letter-spacing:.3px}
    .badge{background:#ffffff22;border:1px solid #ffffff44;padding:4px 8px;border-radius:999px;font-size:12px}
    .wrap{max-width:1000px;margin:0 auto;padding:22px}
    .card{background:#fff;border-radius:16px;box-shadow:0 8px 28px rgba(10,37,64,.08);padding:18px}
    .grid{display:grid;gap:12px}
    .grid-2{grid-template-columns:1fr 1fr}
    .grid-3{grid-template-columns:1fr 1fr 1fr}
    @media(max-width:860px){.grid-2,.grid-3{grid-template-columns:1fr}}
    label{font-weight:600;font-size:14px;margin-bottom:6px;display:block}
    input,select,textarea{width:100%;padding:12px 14px;border:1px solid #e3e3e7;border-radius:12px;font-size:14px;background:#fff}
    .hint{color:var(--muted);font-size:12px;margin-top:4px}
    .btn{padding:12px 16px;border-radius:12px;border:1px solid #d0d5dd;background:#fff;font-weight:700;cursor:pointer}
    .btn.primary{background:var(--brand);color:#fff;border:none}
    .btn.lg{padding:16px 18px;border-radius:16px;font-size:16px}
    .pill{display:inline-block;background:#fff0f6;color:#5f3a52;padding:4px 10px;border-radius:999px;font-size:12px;font-weight:700;border:1px solid #f3d6e5}
    .muted{color:var(--muted)}
    .stepper{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-bottom:16px}
    .step{display:flex;align-items:center;gap:10px;background:#fff;border:1px solid #e6e6ef;border-radius:999px;padding:8px 12px;font-weight:700}
    .step .num{width:22px;height:22px;border-radius:50%;display:grid;place-items:center;background:#f4e4ec;font-weight:800}
    .step.active{background:#fff0f6;border-color:#f3d6e5}
    .h2{font-size:18px;font-weight:800;margin:0 0 8px}
    .row{display:grid;grid-template-columns:120px 1fr 90px 90px 90px 70px 90px;gap:10px;align-items:center;border-bottom:1px solid #f0f0f0;padding:10px}
    .row.header{background:#fafafa;font-weight:700}
    .row:last-child{border-bottom:none}
    .right{text-align:right}
    .list{border:1px solid #eee;border-radius:14px;overflow:hidden}
    .totals{display:flex;justify-content:flex-end;gap:24px;align-items:center;margin-top:14px}
    .actions{display:flex;gap:10px;flex-wrap:wrap}
    .hidden{display:none}
    .sep{height:1px;background:#eee;margin:8px 0 12px}
    .checks{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .checks label{display:flex;align-items:center;gap:8px;font-weight:600}
  </style>
</head>
<body>
<header>
  <h1>ðŸŒ¸ Abuela Tata Â· Pedidos ComuniÃ³n 2026</h1>
  <div class="badge">v2025-10-24-1 Â· igual que Navy</div>
</header>

<div class="wrap">
  <div class="stepper">
    <div class="step active" id="s1"><div class="num">1</div>Datos del cliente</div>
    <div class="step" id="s2"><div class="num">2</div>Modelo y tallas</div>
    <div class="step" id="s3"><div class="num">3</div>Resumen y envÃ­o</div>
  </div>

  <!-- Paso 1: Datos del cliente -->
  <section class="card grid grid-2" id="paso1">
    <div class="h2">Paso 1 Â· Datos del cliente</div>
    <div class="sep" style="grid-column:1/-1"></div>
    <div>
      <label for="tienda">Nombre de la tienda</label>
      <input id="tienda" placeholder="Ej.: Boutique Elegance">
    </div>
    <div>
      <label for="contacto">Persona de contacto</label>
      <input id="contacto" placeholder="Ej.: MarÃ­a PÃ©rez">
    </div>
    <div>
      <label for="ciudad">Ciudad / PaÃ­s</label>
      <input id="ciudad" placeholder="Ej.: Sevilla, EspaÃ±a">
    </div>
    <div>
      <label for="nombreNinaNino">Nombre de niÃ±a o niÃ±o</label>
      <input id="nombreNinaNino" placeholder="Ej.: SofÃ­a / Daniel">
      <div class="hint">Se aÃ±adirÃ¡ en el mensaje del pedido.</div>
    </div>
    <div>
      <label for="fechaServicio">Fecha de servicio</label>
      <input id="fechaServicio" type="date">
      <div class="hint">Fecha objetivo de entrega/servicio.</div>
    </div>
    <div class="grid-2" style="grid-column:1/-1">
      <div>
        <label for="observaciones">Observaciones</label>
        <textarea id="observaciones" rows="3" placeholder="Plazos, comentarios, notas..."></textarea>
      </div>
      <div style="align-self:end;display:flex;gap:10px;justify-content:flex-end">
        <button class="btn" id="to2prev" disabled>AtrÃ¡s</button>
        <button class="btn primary" id="to2">Continuar a modelos</button>
      </div>
    </div>
  </section>

  <!-- Paso 2: Modelo y tallas -->
  <section class="card grid grid-2 hidden" id="paso2">
    <div class="h2">Paso 2 Â· SelecciÃ³n de modelo y tallas</div>
    <div class="sep" style="grid-column:1/-1"></div>
    <div>
      <label for="modelo">Modelo</label>
      <select id="modelo">
        <option value="" disabled selected>â€” Selecciona un modelo â€”</option>
      </select>
      <div class="hint">Los modelos aparecen al abrir el desplegable.</div>
    </div>
    <div class="grid grid-2">
      <div>
        <label for="tallaVestido">Talla</label>
        <select id="tallaVestido">
          <option value="" disabled selected>â€” Selecciona talla â€”</option>
        </select>
      </div>
      <div>
        <label for="cantidad">Cantidad</label>
        <input id="cantidad" type="number" min="1" value="1">
      </div>
    </div>

    <div class="grid grid-3">
      <div>
        <label>Precio base</label>
        <div id="precioBase" class="pill">â€”</div>
      </div>
      <div>
        <label>Suplementos</label>
        <div class="checks">
          <label><input type="checkbox" id="patronEsp"> PatrÃ³n especial (+50â‚¬)</label>
          <label><input type="checkbox" id="cambioManga"> Cambio de manga (+18â‚¬)</label>
        </div>
      </div>
      <div>
        <label>Total lÃ­nea</label>
        <div id="totalLinea" class="pill">â€”</div>
      </div>
    </div>

    <div style="display:flex;gap:10px;justify-content:space-between">
      <button class="btn" id="back1">Volver</button>
      <div class="actions">
        <button class="btn" id="limpiar">Limpiar selecciÃ³n</button>
        <button class="btn primary" id="add" disabled>AÃ±adir lÃ­nea</button>
      </div>
    </div>
  </section>

  <!-- Paso 3: Resumen y envÃ­o -->
  <section class="card hidden" id="paso3">
    <div class="h2">Paso 3 Â· Resumen y envÃ­o</div>
    <div class="sep"></div>
    <div class="list" id="lista">
      <div class="row header hidden" id="headerLineas">
        <div>Modelo</div>
        <div>DescripciÃ³n</div>
        <div class="right">Talla</div>
        <div class="right">Supl.</div>
        <div class="right">Precio</div>
        <div class="right">Cant.</div>
        <div class="right">Importe</div>
      </div>
    </div>
    <div class="totals">
      <strong>Total pedido:</strong>
      <div id="totalPedido" class="pill">0,00 â‚¬</div>
    </div>
    <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
      <button class="btn" id="back2">Volver a modelos</button>
      <div class="actions">
        <button class="btn primary lg" id="btnWhatsApp">Pedir por WhatsApp</button>
        <button class="btn lg" id="btnEmail">Pedir por email</button>
      </div>
    </div>
    <div class="hint" style="margin-top:10px;text-align:center">Gracias por confiar en Abuela Tata ðŸ’•</div>
  </section>
</div>

<script>
// Estructura igual que Navy pero con reglas AT (precio Ãºnico + suplementos)
const DATA = {
  brand: "Abuela Tata",
  whatsapp: "+34621268525",
  size_note: "Tallas disponibles 6Aâ€“16A (mismo precio)",
  supplement_patron: 50,
  supplement_manga: 18,
  sizes: [6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16],
  // Puedes ampliar esta lista con tu tarifa completa (ref + variante + precio)
  items: [{"modelo": "709121", "descripcion": "VESTIDO  COMUNION  26", "precio": 194.0}, {"modelo": "717121", "descripcion": "VESTIDO  COMUNION  26", "precio": 194.0}, {"modelo": "731121", "descripcion": "VESTIDO  COMUNION  26", "precio": 194.0}, {"modelo": "7009122", "descripcion": "VESTIDO  COMUNION  26", "precio": 193.6}, {"modelo": "709122", "descripcion": "VESTIDO SIN VISO COLOR  COMUNION  26", "precio": 193.6}, {"modelo": "7017122", "descripcion": "VESTIDO  COMUNION  26", "precio": 193.6}, {"modelo": "717122", "descripcion": "VESTIDO SIN VISO COLOR  COMUNION  26", "precio": 193.6}, {"modelo": "7024122", "descripcion": "VESTIDO  COMUNION  26", "precio": 193.6}, {"modelo": "724122", "descripcion": "VESTIDO SIN VISO COLOR  COMUNION  26", "precio": 193.6}, {"modelo": "7025122", "descripcion": "VESTIDO  COMUNION  26", "precio": 193.6}, {"modelo": "725122", "descripcion": "VESTIDO SIN VISO COLOR  COMUNION  26", "precio": 193.6}, {"modelo": "7017123", "descripcion": "VESTIDO SIN MANGAS  COMUNION  26", "precio": 213.0}, {"modelo": "717123", "descripcion": "VESTIDO  COMUNION  26", "precio": 213.0}, {"modelo": "7024123", "descripcion": "VESTIDO SIN MANGAS  COMUNION  26", "precio": 213.0}, {"modelo": "724123", "descripcion": "VESTIDO  COMUNION  26", "precio": 213.0}, {"modelo": "7025123", "descripcion": "VESTIDO SIN MANGAS  COMUNION  26", "precio": 213.0}, {"modelo": "725123", "descripcion": "VESTIDO  COMUNION  26", "precio": 213.0}, {"modelo": "7017124", "descripcion": "VESTIDO  COMUNION  26", "precio": 179.95}, {"modelo": "717124", "descripcion": "VESTIDO SIN VISO COLOR  COMUNION  26", "precio": 179.95}, {"modelo": "7024124", "descripcion": "VESTIDO  COMUNION  26", "precio": 179.95}, {"modelo": "724124", "descripcion": "VESTIDO SIN VISO COLOR  COMUNION  26", "precio": 179.95}, {"modelo": "7025124", "descripcion": "VESTIDO  COMUNION  26", "precio": 179.95}, {"modelo": "725124", "descripcion": "VESTIDO SIN VISO COLOR  COMUNION  26", "precio": 179.95}, {"modelo": "709125", "descripcion": "VESTIDO  COMUNION  26", "precio": 199.0}, {"modelo": "717125", "descripcion": "VESTIDO  COMUNION  26", "precio": 199.0}, {"modelo": "724125", "descripcion": "VESTIDO  COMUNION  26", "precio": 199.0}, {"modelo": "725125", "descripcion": "VESTIDO  COMUNION  26", "precio": 199.0}, {"modelo": "704126", "descripcion": "VESTIDO  COMUNION  26", "precio": 221.0}, {"modelo": "709126", "descripcion": "VESTIDO  COMUNION  26", "precio": 221.0}, {"modelo": "704127", "descripcion": "VESTIDO  COMUNION  26", "precio": 174.5}, {"modelo": "724127", "descripcion": "VESTIDO  COMUNION  26", "precio": 174.5}, {"modelo": "725127", "descripcion": "VESTIDO  COMUNION  26", "precio": 174.5}, {"modelo": "709128", "descripcion": "VESTIDO  COMUNION  26", "precio": 157.95}, {"modelo": "717128", "descripcion": "VESTIDO  C OMUNION 26", "precio": 157.95}, {"modelo": "725128", "descripcion": "VESTIDO  COMUNION  26", "precio": 157.95}, {"modelo": "725129", "descripcion": "VESTIDO  COMUNION  26", "precio": 205.0}, {"modelo": "709130", "descripcion": "VESTIDO  COMUNION  25", "precio": 228.0}, {"modelo": "717130", "descripcion": "VESTIDO  COMUNION  26", "precio": 228.0}, {"modelo": "725130", "descripcion": "VESTIDO  COMUNION  26", "precio": 228.0}, {"modelo": "7009131", "descripcion": "VESTIDO  COMUNION  26", "precio": 165.85}, {"modelo": "709131", "descripcion": "VESTIDO SIN VISO COLOR  COMUNION  26", "precio": 160.85}, {"modelo": "7025131", "descripcion": "VESTIDO  COMUNION  26", "precio": 165.85}, {"modelo": "725131", "descripcion": "VESTIDO SIN VISO COLOR  COMUNION  26", "precio": 160.85}, {"modelo": "7016131", "descripcion": "VESTIDO  COMUNION  26", "precio": 165.85}, {"modelo": "716131", "descripcion": "VESTIDO SIN VISO COLOR  COMUNION  26", "precio": 160.85}, {"modelo": "725132", "descripcion": "VESTIDO  COMUNION  26", "precio": 165.0}, {"modelo": "725133", "descripcion": "VESTIDO  COMUNION  26", "precio": 183.0}, {"modelo": "709133", "descripcion": "VESTIDO  COMUNION  26", "precio": 183.0}, {"modelo": "705134", "descripcion": "VESTIDO  COMUNION  26", "precio": 161.0}, {"modelo": "717134", "descripcion": "VESTIDO  COMUNION  26", "precio": 161.0}, {"modelo": "724134", "descripcion": "VESTIDO  COMUNION  26", "precio": 161.0}, {"modelo": "725134", "descripcion": "VESTIDO  COMUNION  26", "precio": 161.0}, {"modelo": "725135", "descripcion": "VESTIDO  COMUNION  26", "precio": 210.0}, {"modelo": "717135", "descripcion": "VESTIDO  COMUNION  26", "precio": 210.0}, {"modelo": "724135", "descripcion": "VESTIDO  COMUNION  26", "precio": 210.0}, {"modelo": "724136", "descripcion": "VESTIDO  C OMUNION 26", "precio": 230.0}, {"modelo": "705136", "descripcion": "VESTIDO  COMUNION  26", "precio": 230.0}, {"modelo": "725136", "descripcion": "VESTIDO  COMUNION  26", "precio": 230.0}, {"modelo": "700137", "descripcion": "VESTIDO  C OMUNION 26", "precio": 166.85}, {"modelo": "709137", "descripcion": "VESTIDO  C OMUNION 26", "precio": 166.85}, {"modelo": "725137", "descripcion": "VESTIDO  C OMUNION 26", "precio": 166.85}, {"modelo": "705138", "descripcion": "VESTIDO  COMUNION  26", "precio": 149.0}, {"modelo": "724138", "descripcion": "VESTIDO  COMUNION  26", "precio": 149.0}, {"modelo": "725138", "descripcion": "VESTIDO  COMUNION  26", "precio": 149.0}, {"modelo": "726139", "descripcion": "VESTIDO  COMUNION  26", "precio": 195.0}, {"modelo": "709139", "descripcion": "VESTIDO  COMUNION  26", "precio": 195.0}, {"modelo": "725140", "descripcion": "VESTIDO  COMUNION  26 SIN MANGA", "precio": 150.0}, {"modelo": "7025140", "descripcion": "VESTIDO  COM. MANGA LARGA", "precio": 168.0}, {"modelo": "717140", "descripcion": "VESTIDO  COMUNION  26", "precio": 150.0}, {"modelo": "7017140", "descripcion": "VESTIDO  COM. MANGA LARGA", "precio": 168.0}, {"modelo": "724140", "descripcion": "VESTIDO  COMUNION  26", "precio": 150.0}, {"modelo": "7024140", "descripcion": "VESTIDO  COM. MANGA LARGA", "precio": 168.0}, {"modelo": "731141", "descripcion": "VESTIDO  COMUNION  26", "precio": 139.0}, {"modelo": "7031141", "descripcion": "VESTIDO  MANGA SISA", "precio": 139.0}, {"modelo": "732141", "descripcion": "VESTIDO  COMUNION  26", "precio": 139.0}, {"modelo": "7032141", "descripcion": "VESTIDO MANGA SISA", "precio": 139.0}, {"modelo": "LAZADA", "descripcion": "COLORIDO GENERAL", "precio": 13.5}, {"modelo": "601142", "descripcion": "TIARA", "precio": 43.0}, {"modelo": "602142", "descripcion": "TIARA", "precio": 39.85}, {"modelo": "603142", "descripcion": "TIARA", "precio": 39.2}, {"modelo": "604142", "descripcion": "TIARA", "precio": 41.65}, {"modelo": "605142", "descripcion": "TIARA", "precio": 37.95}, {"modelo": "606142", "descripcion": "TIARA", "precio": 39.55}, {"modelo": "607142", "descripcion": "TIARA", "precio": 39.65}, {"modelo": "608142", "descripcion": "TIARA", "precio": 40.35}, {"modelo": "609142", "descripcion": "TIARA", "precio": 42.85}, {"modelo": "611142", "descripcion": "TIARA", "precio": 37.95}, {"modelo": "612142", "descripcion": "TIARA", "precio": 33.05}, {"modelo": "613142", "descripcion": "TIARA", "precio": 38.95}, {"modelo": "614142", "descripcion": "TIARA", "precio": 50.1}, {"modelo": "615142", "descripcion": "TIARA", "precio": 38.3}, {"modelo": "616142", "descripcion": "TIARA", "precio": 37.25}, {"modelo": "617142", "descripcion": "TIARA", "precio": 39.2}, {"modelo": "1800999", "descripcion": "LAZADA COLOR BLANCO ROTO", "precio": 13.5}, {"modelo": "1801999", "descripcion": "LAZADA COLOR ROSA", "precio": 13.5}, {"modelo": "1805999", "descripcion": "LAZADA COLOR BEIGE", "precio": 13.5}, {"modelo": "1809999", "descripcion": "LAZADA COLOR VERDE AGUA", "precio": 13.5}, {"modelo": "1816999", "descripcion": "LAZADA COLOR NUDE", "precio": 13.5}, {"modelo": "1817999", "descripcion": "LAZADA COLOR AZUL", "precio": 13.5}, {"modelo": "1824999", "descripcion": "LAZADA COLOR MENTA", "precio": 13.5}, {"modelo": "1825999", "descripcion": "LAZADA COLOR MAQUILLAJE", "precio": 13.5}, {"modelo": "1826999", "descripcion": "LAZADA COLOR MALVA", "precio": 13.5}, {"modelo": "1831999", "descripcion": "LAZADA COLOR VINO", "precio": 13.5}, {"modelo": "1832999", "descripcion": "LAZADA COLOR OLIVA", "precio": 13.5}]
};

function euros(n){ return (n||0).toLocaleString('es-ES', {style:'currency', currency:'EUR'}); }

const state = { lineas: [] };

// Elements
const $modelo = document.getElementById('modelo');
const $tallaVestido = document.getElementById('tallaVestido');
const $cantidad = document.getElementById('cantidad');
const $precioBase = document.getElementById('precioBase');
const $totalLinea = document.getElementById('totalLinea');
const $lista = document.getElementById('lista');
const $totalPedido = document.getElementById('totalPedido');
const $headerLineas = document.getElementById('headerLineas');
const $btnAdd = document.getElementById('add');
const $patronEsp = document.getElementById('patronEsp');
const $cambioManga = document.getElementById('cambioManga');

// Steps
const paso1 = document.getElementById('paso1');
const paso2 = document.getElementById('paso2');
const paso3 = document.getElementById('paso3');
const s1 = document.getElementById('s1');
const s2 = document.getElementById('s2');
const s3 = document.getElementById('s3');

function go(n){
  [paso1,paso2,paso3].forEach((p,i)=>p.classList.toggle('hidden', i!==n-1));
  [s1,s2,s3].forEach((el,i)=>el.classList.toggle('active', i===n-1));
}
document.getElementById('to2').addEventListener('click', ()=> go(2));
document.getElementById('back1').addEventListener('click', ()=> go(1));
document.getElementById('back2').addEventListener('click', ()=> go(2));

// Lazy populate
let modelsPopulated=false, sizesPopulated=false;
function populateModels(){ if(modelsPopulated) return; DATA.items.forEach(it=>{ const o=document.createElement('option'); o.value=JSON.stringify(it); o.textContent=`${it.modelo} Â· ${it.descripcion}`; $modelo.appendChild(o); }); modelsPopulated=true; }
function populateSizes(){ if(sizesPopulated) return; DATA.sizes.forEach(s=>{ const a=document.createElement('option'); a.value=s; a.textContent=s+'A'; $tallaVestido.appendChild(a); }); sizesPopulated=true; }
['focus','mousedown','click'].forEach(ev=>{ $modelo.addEventListener(ev, populateModels); $tallaVestido.addEventListener(ev, populateSizes); });

function validarLinea(){ const v=$modelo.value && $tallaVestido.value; $btnAdd.disabled=!v; return v; }

function calcularLinea(){
  if(!validarLinea()){ $precioBase.textContent='â€”'; $totalLinea.textContent='â€”'; return; }
  const item = JSON.parse($modelo.value);
  const base = item.precio || 0;
  const sup = ($patronEsp.checked?DATA.supplement_patron:0) + ($cambioManga.checked?DATA.supplement_manga:0);
  const cant = Math.max(1, Number($cantidad.value||1));
  $precioBase.textContent = euros(base) + (sup? `  (+${euros(sup)} supl.)` : "");
  $totalLinea.textContent = euros((base+sup)*cant);
}
['change','input'].forEach(ev=>{ $modelo.addEventListener(ev, calcularLinea); $tallaVestido.addEventListener(ev, calcularLinea); $cantidad.addEventListener(ev, calcularLinea); $patronEsp.addEventListener(ev, calcularLinea); $cambioManga.addEventListener(ev, calcularLinea); });

document.getElementById('limpiar').addEventListener('click', ()=>{ $modelo.value=''; $tallaVestido.value=''; $cantidad.value=1; $patronEsp.checked=false; $cambioManga.checked=false; calcularLinea(); });

document.getElementById('add').addEventListener('click', ()=>{
  if(!validarLinea()) return;
  const it = JSON.parse($modelo.value);
  const talla = Number($tallaVestido.value);
  const cant = Math.max(1, Number($cantidad.value||1));
  const sup = ($patronEsp.checked?DATA.supplement_patron:0) + ($cambioManga.checked?DATA.supplement_manga:0);
  const precioUnit = (it.precio||0) + sup;
  const importe = precioUnit * cant;
  const suplementosTxt = (sup? (( $patronEsp.checked?'+50â‚¬ PatrÃ³n ':'' ) + ( $cambioManga.checked?'+18â‚¬ Manga':'' )).trim() : 'â€”');
  state.lineas.push({ modelo:it.modelo, descripcion:it.descripcion, talla:talla, cantidad:cant, precioUnit, importe, suplementos:suplementosTxt });
  renderPedido();
  go(3);
});

function renderPedido(){
  document.querySelectorAll('#lista .row.item').forEach(el=>el.remove());
  let total=0; state.lineas.forEach((ln,idx)=>{ total+=ln.importe; const row=document.createElement('div'); row.className='row item'; row.innerHTML=`<div>${ln.modelo}</div><div>${ln.descripcion}</div><div class="right">${ln.talla}A</div><div class="right">${ln.suplementos}</div><div class="right">${euros(ln.precioUnit)}</div><div class="right">${ln.cantidad}</div><div class="right">${euros(ln.importe)} <a href="#" data-idx="${idx}" class="muted" style="margin-left:8px">Eliminar</a></div>`; row.querySelector('a').addEventListener('click',e=>{e.preventDefault(); eliminarLinea(idx);}); $lista.appendChild(row); });
  $headerLineas.classList.toggle('hidden', state.lineas.length===0);
  $totalPedido.textContent = euros(total);
}
function eliminarLinea(i){ state.lineas.splice(i,1); renderPedido(); }

function fechaHoyES(){
  const d = new Date();
  const dd = String(d.getDate()).padStart(2,'0');
  const mm = String(d.getMonth()+1).padStart(2,'0');
  const yyyy = d.getFullYear();
  return `${dd}/${mm}/${yyyy}`;
}

function buildMensaje(){
  const tienda = document.getElementById('tienda').value||'';
  const contacto = document.getElementById('contacto').value||'';
  const ciudad = document.getElementById('ciudad').value||'';
  const nombreNinaNino = document.getElementById('nombreNinaNino').value||'';
  const fechaServicio = document.getElementById('fechaServicio').value||'';
  const obs = document.getElementById('observaciones').value||'';
  const fechaPedido = fechaHoyES();
  let msg = `ðŸŒ¸ Abuela Tata\nðŸ“† Fecha del pedido: ${fechaPedido}\n`;
  if(tienda) msg += `Tienda: ${tienda}\n`;
  if(contacto) msg += `Contacto: ${contacto}\n`;
  if(ciudad) msg += `Ciudad: ${ciudad}\n`;
  if(nombreNinaNino) msg += `Nombre de niÃ±a o niÃ±o: ${nombreNinaNino}\n`;
  if(fechaServicio) msg += `Fecha de servicio: ${fechaServicio}\n`;
  msg += `\nLÃ­neas:\n`;
  state.lineas.forEach((ln,i)=>{ msg += `${i+1}) ${ln.modelo} Â· ${ln.descripcion} â€” Talla ${ln.talla}A â€” Supl.: ${ln.suplementos} â€” Cant: ${ln.cantidad} â€” Precio: ${euros(ln.precioUnit)} â€” Importe: ${euros(ln.importe)}\n`; });
  msg += `\nTotal: ${document.getElementById('totalPedido').textContent}\n`;
  if(obs) msg += `\nObs.: ${obs}\n`;
  msg += `\nNota: Suplementos por lÃ­nea: +50â‚¬ PatrÃ³n especial Â· +18â‚¬ Cambio de manga.`;
  return msg;
}

// URL prefill
function getParam(k){ const u=new URL(window.location.href); return u.searchParams.get(k)||''; }
(function prefillFromURL(){
  const fields = [
    ['tienda','tienda'],
    ['contacto','contacto'],
    ['ciudad','ciudad'],
    ['nombre','nombreNinaNino'],
    ['fecha','fechaServicio'],
    ['obs','observaciones']
  ];
  fields.forEach(([param,id])=>{ const v=getParam(param); if(v) document.getElementById(id).value=v; });
})();

document.getElementById('btnWhatsApp').addEventListener('click', ()=>{
  const num = DATA.whatsapp.replace(/[^+0-9]/g,'');
  const url = `https://wa.me/${num}?text=${encodeURIComponent(buildMensaje())}`;
  window.open(url,'_blank');
});

document.getElementById('btnEmail').addEventListener('click', ()=>{
  const fechaPedido = fechaHoyES();
  const subject = `Abuela Tata â€“ ${fechaPedido}`;
  const body = buildMensaje();
  const url = `mailto:info@abuelatata.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
  window.location.href = url;
});

// NavegaciÃ³n entre pasos
document.getElementById('to2').addEventListener('click', ()=>{});
if('serviceWorker' in navigator){ /* opcional: registrar SW si luego lo aÃ±ades */ }

</script>
</body>
</html>
